# Настройка интеграции с QuickTickets API

## Описание

Интеграция с API QuickTickets позволяет получать актуальное расписание спектаклей и ссылки на продажу билетов.

## Настройка

### 1. Настройка переменных окружения

Создайте файл `.env` в корне проекта `theater-website` и добавьте ваши токены:

```env
REACT_APP_QUICKTICKETS_API_TOKEN=ваш_api_token
REACT_APP_QUICKTICKETS_API_SALT=ваш_api_salt
REACT_APP_QUICKTICKETS_ORG_ID=ваш_organisation_id_или_алиас
```

**Пример:**
```env
REACT_APP_QUICKTICKETS_API_TOKEN=tkS650sTobzj4Xwd
REACT_APP_QUICKTICKETS_API_SALT=wQWu0PtRuJkx2l2DnqmRbV0sDYoUCEse
REACT_APP_QUICKTICKETS_ORG_ID=12345
```

**Важно:**
- `REACT_APP_QUICKTICKETS_API_TOKEN` и `REACT_APP_QUICKTICKETS_API_SALT` - **обязательны** для авторизации
- `REACT_APP_QUICKTICKETS_ORG_ID` - **опционален**. Если не указан, система будет искать мероприятия по всем организациям (медленнее, но работает)

### 2. Получение ID организации (опционально)

Если вы хотите указать конкретную организацию (рекомендуется для производительности), вы можете:

**Вариант 1:** Использовать функцию `fetchOrganisations()` в консоли браузера:
```javascript
// В консоли браузера на странице вашего сайта
import { fetchOrganisations } from './api/quicktickets';
fetchOrganisations().then(orgs => console.log(orgs));
```

**Вариант 2:** Обратиться в поддержку QuickTickets

**Вариант 3:** Оставить пустым - система автоматически найдет вашу организацию по названиям спектаклей

### 3. Перезапуск приложения

После добавления переменных окружения перезапустите приложение:

```bash
npm start
```

## Как это работает

1. На странице отдельного спектакля (`/performances/:id`) система автоматически:
   - Загружает информацию о спектакле из Strapi
   - Ищет соответствующее мероприятие в QuickTickets API по названию спектакля
   - Получает список будущих сеансов (детализаций)
   - Отображает даты, время, цены и кнопки "Купить билет"

2. Поиск мероприятия происходит по нечеткому совпадению названий:
   - Точное совпадение
   - Вхождение названия спектакля в название мероприятия
   - Вхождение названия мероприятия в название спектакля

## Структура данных

### Сеанс (Session) содержит:
- `id` - ID сеанса
- `timeStart` - Время начала (Unix timestamp)
- `timeEnd` - Время окончания
- `url` - Ссылка на продажу билетов
- `minPrice` - Минимальная цена
- `maxPrice` - Максимальная цена
- `hall` - Информация о зале
- `pushkincard` - Поддержка Пушкинской карты

## Документация API

Полная документация API QuickTickets: https://wiki.qksr.ru/ru/api/afisha

## Устранение проблем

### Сеансы не загружаются

1. Проверьте, что переменная окружения `REACT_APP_QUICKTICKETS_ORG_ID` установлена
2. Проверьте, что название спектакля в Strapi совпадает с названием мероприятия в QuickTickets
3. Проверьте консоль браузера на наличие ошибок CORS или API
4. Убедитесь, что у организации есть опубликованные мероприятия с включенными онлайн продажами

### CORS ошибки

Если возникают ошибки CORS, возможно потребуется:
- Настроить CORS на стороне QuickTickets API
- Или использовать прокси-сервер

## Дополнительные возможности

В будущем можно добавить:
- Кэширование данных сеансов
- Обновление расписания в реальном времени
- Фильтрацию по датам
- Отображение доступных мест

